<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-View Local Testing Grid</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter font ka upyog */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* light background */
        }
        .browser-container {
            border: 1px solid #e2e8f0; /* slate-200 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border-radius: 0.75rem; /* rounded-xl */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
        }
        .browser-content {
            flex-grow: 1;
            height: 400px; /* Default height for visibility */
        }
        .browser-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* Grid layout for responsiveness */
        @media (min-width: 1024px) {
            #browser-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 columns on desktop */
            }
        }
    </style>
</head>
<body>

    <div class="min-h-screen p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            
            <!-- Header -->
            <header class="mb-8 text-center">
                <h1 class="text-4xl font-extrabold text-gray-900 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-700">
                    Local/Staging Test Grid (स्थानीय जाँच ग्रिड)
                </h1>
                <p class="text-gray-500 mt-2 text-lg">
                    एक ही समय में विभिन्न views (Localhost, Staging, Production) की जाँच करें।
                </p>
            </header>

            <!-- !!! CRITICAL SECURITY WARNING (Red/Laal Rang) !!! -->
            <div class="mb-6 p-4 bg-red-100 text-red-700 rounded-xl border border-red-300 text-base font-bold flex items-center gap-3 shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                <div class="flex flex-col">
                    <span class="text-xl text-red-600">अति आवश्यक सूचना (Critical Note):</span>
                    <span>
                        वेबसाइट सुरक्षा नियमों (X-Frame-Options/CSP) के कारण, **Google, YouTube, Facebook** जैसी बड़ी वेबसाइटें **किसी भी हाल में** यहाँ लोड नहीं हो सकती हैं। यह टूल **केवल आपके अपने Localhost या Staging URLs** के लिए बनाया गया है।
                    </span>
                </div>
            </div>

            <!-- Global Search Bar -->
            <div class="mb-10 p-4 bg-white rounded-xl shadow-lg border border-gray-200">
                <form id="global-url-form" class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
                    <div class="flex-1 flex items-center bg-gray-50 border border-gray-300 rounded-lg p-3 text-base shadow-inner focus-within:ring-2 focus-within:ring-indigo-500/50 transition-all">
                        <span class="text-gray-500 mr-3 font-semibold">URL:</span>
                        <input 
                            type="text" 
                            id="global-url-input"
                            placeholder="Localhost या Staging URL दर्ज करें (e.g., http://localhost:3000/home)"
                            class="flex-1 outline-none text-gray-800 font-medium placeholder-gray-400 bg-transparent"
                            value="http://localhost:3000"
                        />
                    </div>
                    <button 
                        type="submit" 
                        class="shrink-0 px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-lg shadow-indigo-500/30 transition-all active:scale-[0.98]"
                    >
                        सभी 3 पैनल्स पर नेविगेट करें
                    </button>
                </form>
            </div>
            
            <!-- Dynamic Grid Container -->
            <div id="browser-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 transition-all duration-300">
                <!-- Browser windows will be injected here by JavaScript -->
            </div>

        </div>
    </div>

    <script>
        // Default URLs for the three panels
        let browsers = [
            { id: 1, title: 'Local Development (Chrome View)', currentUrl: 'http://localhost:3000/dev', userAgent: 'Chrome' },
            { id: 2, title: 'Staging Server (Firefox View)', currentUrl: 'http://localhost:3000/staging', userAgent: 'Firefox' },
            { id: 3, title: 'Production Backup (Safari View)', currentUrl: 'http://localhost:3000/prod', userAgent: 'Safari' },
        ];
        
        const gridContainer = document.getElementById('browser-grid');

        /**
         * Creates the full HTML structure for a single browser window.
         * @param {object} browser - Browser state object.
         * @returns {string} - Browser window's HTML string.
         */
        function createBrowserWindow(browser) {
            const { id, title, currentUrl, userAgent } = browser;
            
            // NOTE: The iframe is now loading the actual (local/staging) URL. 
            // We use 'about:blank' only for blocked external sites, but since 
            // we are focusing on local testing, we let it try the URL.
            const safeUrl = currentUrl.startsWith('http') ? currentUrl : `https://${currentUrl}`;

            return `
                <div id="browser-${id}" class="browser-container h-[450px]">
                    
                    <!-- Browser Toolbar -->
                    <div class="bg-gray-100 border-b border-gray-200 p-3 flex items-center gap-2 select-none">
                        <span class="text-xs font-semibold text-gray-700 mr-2">${userAgent}:</span>
                        <div class="flex-1 flex items-center bg-white border border-gray-300 rounded-lg px-3 py-1.5 text-sm shadow-inner">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe text-indigo-500 mr-2"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                            <span class="text-gray-800 truncate" title="${currentUrl}">${currentUrl}</span>
                        </div>
                        <button onclick="handleRefresh(${id})" class="p-1.5 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors" title="Refresh">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-cw"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.76 2.87"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.76-2.87"/><path d="M21 21v-5h-5"/></svg>
                        </button>
                    </div>

                    <!-- Browser Content Area (Real iFrame) -->
                    <div class="browser-content">
                        <!-- 
                            Sandboxing is removed to allow cross-origin content when possible (e.g. for user's own staging servers) 
                            But be aware that Google/YouTube will still be blocked by their own server settings.
                        -->
                        <iframe 
                            id="iframe-${id}" 
                            src="${safeUrl}" 
                            title="Browser Node ${id} - ${safeUrl}"
                            onload="handleIframeLoad(${id}, true)"
                            onerror="handleIframeLoad(${id}, false)"
                        ></iframe>
                    </div>
                </div>
            `;
        }

        /**
         * Rerenders the entire browser grid.
         */
        function renderBrowsers() {
            gridContainer.innerHTML = browsers.map(createBrowserWindow).join('');
        }

        /**
         * Navigates all browsers using the Global URL input.
         */
        window.handleGlobalNavigate = function(event) {
            event.preventDefault();
            const globalInput = document.getElementById('global-url-input');
            let newUrl = globalInput.value.trim();

            if (!newUrl) {
                console.error('कृपया URL दर्ज करें।');
                return;
            }
            
            // URL correction
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                newUrl = 'http://' + newUrl; // Defaulting to http for local dev
            }

            // 1. Update state for all browsers
            browsers = browsers.map(b => ({
                ...b, 
                currentUrl: newUrl,
            }));
            
            // 2. Rerender the UI to update the iframe src attribute
            renderBrowsers();
            console.log(`सभी ${browsers.length} पैनल्स पर ${newUrl} नेविगेट करने का प्रयास किया गया।`);
        };
        
        /**
         * Simulates a browser refresh by reloading the iframe.
         */
        window.handleRefresh = function(id) {
            const iframe = document.getElementById(`iframe-${id}`);
            if (iframe) {
                // Force a reload of the iframe source
                iframe.src = iframe.src;
                console.log(`Browser ${id} Refreshing: ${iframe.src}`);
            }
        };

        // Iframe load handler (mostly for debugging)
        window.handleIframeLoad = function(id, success) {
            if (!success) {
                console.warn(`Browser ${id} load failed or was blocked. Check Console for details.`);
            }
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            renderBrowsers();
            // Global Navigation Listener
            document.getElementById('global-url-form').addEventListener('submit', handleGlobalNavigate);
        });

    </script>
</body>
</html>